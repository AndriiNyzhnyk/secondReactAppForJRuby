<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>React Game</title>
    <link rel="stylesheet" type="text/css" href="css/normalize.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">
</head>
<body>

<div id="content"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.7/es5-shim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.7/es5-sham.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/json3/3.3.2/json3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/es6-shim/0.34.2/es6-shim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/es6-shim/0.34.2/es6-sham.min.js"></script>
<script src="https://wzrd.in/standalone/es7-shim@latest"></script>
<script crossorigin src="https://unpkg.com/react@16/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.25.0/babel.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>


<script type="text/babel">
    {
        window.gPrevItem = '';
        window.gCurItem = '';
    }

    class Main extends React.Component {
        constructor(props) {
            super(props);
            this.state = {
                init: false,
                userName: '',
                images: [
                    'img/adium.png',
                    'img/freebsd.png',
                    'img/thebat.png',
                    'img/evernote.png',
                    'img/linux.png',
                    'img/firefox.png',
                    'img/adium.png',
                    'img/monkeys.png',
                    'img/evernote.png',
                    'img/firefox.png',
                    'img/freebsd.png',
                    'img/linux.png',
                    'img/twitter.png',
                    'img/monkeys.png',
                    'img/thebat.png',
                    'img/twitter.png'
                ]
            };
        };

        setDataUser = () => {
            const userName = $('#name').val();
            if(userName == '') {
                alert('Введіть коректне ім\'я');
                return;
            }
            $('#name').val('');
            this.setState({
                init: true,
                userName: userName
            });
        };

        startGame(item, index) {
            return (
                <Game img={item} key={index} id={'item' + (index + 1)}/>
            );
        };

        welcome() {
            return (
                <div id="welcome">
                    <h3>Введіть своє ім'я</h3>
                    <textarea required wrap="off" id="name"
                              placeholder="Ваше ім'я"></textarea><br />
                    <button onClick={this.setDataUser} id="newGame">Почати гру</button>
                </div>
            )
        };

        render() {
            if(!this.state.init) {
                return this.welcome();
            } else {
                return this.state.images.map(this.startGame);
            }
        }
    }

    class Game extends React.Component {
        constructor(props) {
            super(props);
            this.state = {
                comparisonTable: {
                    item1: 'item7',
                    item2: 'item11',
                    item3: 'item15',
                    item4: 'item9',
                    item5: 'item12',
                    item6: 'item10',
                    item8: 'item14',
                    item13: 'item16'
                }
            };
        };

        clickBlock = (e) => {
            const elem = e.target.id;
            console.log(elem);

            if(gPrevItem === '') {
                gPrevItem = elem;
                console.log( 'gPrevItem ' + gPrevItem);
            } else {
               gCurItem = elem;
               console.log('gCurItem ' + gCurItem);
                this.compare();
            }
        };

        compare = () => {
            if(this.state.comparisonTable[gPrevItem] === gCurItem) {
                this.deleteBlock();
            } else if(this.state.comparisonTable[gCurItem] === gPrevItem) {
                this.deleteBlock();
            } else {
                console.log('Think');
                this.nullifySelectedItem();
            }
        };

        nullifySelectedItem() {
            gPrevItem = '';
            gCurItem = '';
        };

        deleteBlock = () => {
            console.log('delete');


            this.nullifySelectedItem();
        };
        

        render = () => {
            return (
                <div className="block" id={this.props.id} onClick={this.clickBlock}>
                    <img src={this.props.img} alt="animal"></img>
                </div>
            )
        };
    }

    ReactDOM.render(<Main/>, document.getElementById("content"));

</script>

</body>
</html>