<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>React Game</title>
    <link rel="stylesheet" type="text/css" href="css/normalize.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">
</head>
<body>

<div id="content"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.7/es5-shim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.7/es5-sham.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/json3/3.3.2/json3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/es6-shim/0.34.2/es6-shim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/es6-shim/0.34.2/es6-sham.min.js"></script>
<script src="https://wzrd.in/standalone/es7-shim@latest"></script>
<script crossorigin src="https://unpkg.com/react@16/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.25.0/babel.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>


<script type="text/babel">
    {
        window.gPrevItem = '';
        window.gCurItem = '';
        window.keyPrevItem = null;
        window.keyCurItem = null;
    }

    class Main extends React.Component {
        constructor(props) {
            super(props);
            this.state = {
                init: false,
                userName: '',
                images: [
                    'img/adium.png',
                    'img/freebsd.png',
                    'img/thebat.png',
                    'img/evernote.png',
                    'img/linux.png',
                    'img/firefox.png',
                    'img/adium.png',
                    'img/monkeys.png',
                    'img/evernote.png',
                    'img/firefox.png',
                    'img/freebsd.png',
                    'img/linux.png',
                    'img/twitter.png',
                    'img/monkeys.png',
                    'img/thebat.png',
                    'img/twitter.png'
                ]
            };
        };

        welcome() {
            return (
                <div id="welcome">
                    <h3>Введіть своє ім'я</h3>
                    <textarea required wrap="off" id="name"
                              placeholder="Ваше ім'я"></textarea><br />
                    <button onClick={this.setDataUser} id="newGame">Почати гру</button>
                </div>
            )
        };

        setDataUser = () => {
            const userName = $('#name').val();
            if(userName == '') {
                alert('Введіть коректне ім\'я');
                return;
            }
            $('#name').val('');
            this.setState({
                init: true,
                userName: userName
            });
        };

        startGame = (item, index) => {
            return (
                <Game img={item}
                      key={index}
                      id={'item_' + (index)}
                      remove={this.deleteBlock} />
            );
        };

        deleteBlock = (item1, item2) => {
            let arr = this.state.images;
            arr.splice (item1, 1);
            arr.splice (item2 - 1, 1);
            this.setState({images: arr});
        };

        render() {
            if(!this.state.init) {
                return this.welcome();
            } else {
                return this.state.images.map(this.startGame);
            }
        }
    }

    class Game extends React.Component {
        constructor(props) {
            super(props);
            this.state = {};
        };

        clickBlock = (e) => {
            const elem = this.props.img;

            if(gPrevItem === '') {
                gPrevItem = elem;
                keyPrevItem = this.props.id.charAt(5);
            } else {
                gCurItem = elem;
                keyCurItem = this.props.id.charAt(5);
                this.compare();
            }
        };

        compare = () => {
            if(gPrevItem === gCurItem && keyPrevItem !== keyCurItem) {
                this.deleteBlock();
                this.nullifySelectedItem();
            } else {
                console.log('Think');
                this.nullifySelectedItem();
            }
        };

        deleteBlock = () => {
           if(keyPrevItem > keyCurItem) {
               this.props.remove(keyCurItem, keyPrevItem);
           } else {
                this.props.remove(keyPrevItem, keyCurItem);
           }
            console.log('delete');
        };

        nullifySelectedItem() {
            gPrevItem = '';
            gCurItem = '';
        };

        render = () => {
            return (
                <div className="block" id={this.props.id} onClick={this.clickBlock}>
                    <img src={this.props.img} alt="animal"></img>
                </div>
            )
        };
    }

    ReactDOM.render(<Main/>, document.getElementById("content"));

</script>

</body>
</html>